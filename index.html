<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Registrazione Chiamata</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
</head>
<body class="bg-primary text-dark">
<div class="container bg-white p-4 rounded mt-5 shadow">
    <h4 class="mb-4">Registrazione esito chiamata</h4>

    <!-- Campi iniziali -->
    <div class="mb-3">
        <label class="form-label">Numero chiamante</label>
        <input type="text" id="numeroChiamante" class="form-control" readonly />
    </div>

    <div class="mb-3">
        <label class="form-label">Data e ora inizio chiamata</label>
        <input type="text" id="dataInizio" class="form-control" readonly />
    </div>

    <div class="mb-3">
        <label class="form-label">Data e ora fine chiamata</label>
        <input type="text" id="dataFine" class="form-control" readonly />
    </div>

    <!-- Sezione motivi -->
    <div class="mb-4">
        <label class="form-label">Motivi della chiamata</label>

        <!-- Riga: Prenotazione -->
        <div class="row align-items-center mb-2">
            <div class="col-auto">
                <input class="form-check-input" type="checkbox" id="motivoPrenotazione" value="Prenotazione" />
            </div>
            <div class="col-auto">
                <label class="form-check-label" for="motivoPrenotazione">Prenotazione</label>
            </div>
            <div class="col">
                <input type="number" class="form-control" id="numPrenotazione" min="0" value="0" />
            </div>
        </div>

        <!-- Riga: Modifica -->
        <div class="row align-items-center mb-2">
            <div class="col-auto">
                <input class="form-check-input" type="checkbox" id="motivoModifica" value="Modifica" />
            </div>
            <div class="col-auto">
                <label class="form-check-label" for="motivoModifica">Modifica</label>
            </div>
            <div class="col">
                <input type="number" class="form-control" id="numModifica" min="0" value="0" />
            </div>
        </div>

        <!-- Riga: Disdetta -->
        <div class="row align-items-center mb-2">
            <div class="col-auto">
                <input class="form-check-input" type="checkbox" id="motivoDisdetta" value="Disdetta" />
            </div>
            <div class="col-auto">
                <label class="form-check-label" for="motivoDisdetta">Disdetta</label>
            </div>
            <div class="col">
                <input type="number" class="form-control" id="numDisdetta" min="0" value="0" />
            </div>
        </div>

        <!-- Riga: Informazione -->
        <div class="row align-items-center">
            <div class="col-auto">
                <input class="form-check-input" type="checkbox" id="motivoInformazione" value="Informazione" />
            </div>
            <div class="col-auto">
                <label class="form-check-label" for="motivoInformazione">Informazione</label>
            </div>
            <div class="col">
                <input type="number" class="form-control" id="numInformazione" min="0" value="0" />
            </div>
        </div>
    </div>

    <!-- Bottone conferma -->
    <div class="d-grid">
        <button class="btn btn-primary" onclick="inviaDati()">CONFERMA</button>
    </div>
</div>

<!-- Script -->
<script>
    function getParam(name) {
        return new URLSearchParams(window.location.search).get(name);
    }

    document.getElementById("numeroChiamante").value = getParam("numero_chiamante") || "";
    document.getElementById("dataInizio").value = getParam("inizio") || "";
    document.getElementById("dataFine").value = getParam("fine") || "";

    async function inviaDati() {
        const motivi = [
            { id: "motivoPrenotazione", input: "numPrenotazione", label: "Prenotazione" },
            { id: "motivoModifica", input: "numModifica", label: "Modifica" },
            { id: "motivoDisdetta", input: "numDisdetta", label: "Disdetta" },
            { id: "motivoInformazione", input: "numInformazione", label: "Informazione" }
        ];

        const dettagliMotivi = {};

        motivi.forEach(m => {
            const valore = parseInt(document.getElementById(m.input).value || "0", 10);
            dettagliMotivi[m.label] = valore;
        });

        const payload = {
            numero_chiamante: document.getElementById("numeroChiamante").value,
            data_inizio: document.getElementById("dataInizio").value,
            data_fine: document.getElementById("dataFine").value,
            motivi: dettagliMotivi
        };

        // Mostra l'alert con il JSON formattato
        alert(JSON.stringify(payload, null, 2));

        try {
            const response = await fetch("https://YOUR_CLOUD_FUNCTION_URL", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                alert("Registrazione avvenuta con successo.");
            } else {
                alert("Errore durante il salvataggio.");
            }
        } catch (error) {
            console.error("Errore:", error);
            alert("Errore di rete.");
        }
    }
</script>
</body>
</html>
